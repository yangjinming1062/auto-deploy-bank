# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Discord Components is a library of web components for building and displaying fake Discord messages. The project is structured as a monorepo with:
- **packages/core**: Core Lit-based web components (vanilla)
- **packages/react**: React bindings wrapping core components
- **packages/documentation**: Astro-based documentation site

## Common Commands

```bash
# Install dependencies ( Yarn v4 )
yarn --immutable

# Build all packages
yarn build

# Build individually
yarn build:core    # Build core with TypeScript + custom elements manifest
yarn build:react   # Build React bindings with tsup

# Watch mode for core development
yarn workspace @skyra/discord-components-core watch

# Lint and format
yarn lint          # ESLint on packages/ --fix
yarn format        # Prettier on entire repo

# Run inject scripts (auto-generates index exports)
yarn inject
```

## Architecture

### Core Package (`packages/core`)
- 50+ web components built with [Lit](https://lit.dev/)
- Each component lives in its own directory under `src/components/`
- Component pattern:
  ```ts
  import { css, html, LitElement } from 'lit';
  import { customElement, property } from 'lit/decorators.js';

  @customElement('discord-message')
  export class DiscordMessage extends LitElement {
    public static override readonly styles = css`...`;
    @property() public accessor author: string = 'User';
    protected override render() { return html`...`; }
  }
  ```
- Uses `@lit/context` for shared state (theme, compact mode, background) via `DiscordMessages` component
- Index file (`packages/core/src/index.ts`) is auto-generated - do not edit manually

### React Package (`packages/react`)
- Wraps core components using `@lit/react`'s `createComponent`
- All exports auto-generated in `packages/react/src/index.ts`
- Uses tsup for bundling (outputs both ESM and CJS)

### Build System
- **Core**: TypeScript compiler (`tsc -b`) + Custom Elements Manifest analyzer (`cem`)
- **React**: tsup (bundles to ESM + CJS with types)
- Export/side-effects files regenerated by `yarn inject` scripts in `scripts/`

### Linting
- ESLint with flat config (`eslint.config.js`)
- Plugins: lit, lit-a11y, wc (web components)
- Config extends `eslint-config-neon`

### Testing
- Use web dev server for manual testing: `yarn workspace @skyra/discord-components-core start`
- Components have a demo page in `packages/core/demo`

## Key Patterns

### Property/Attribute Mapping
- Boolean properties use `property({ type: Boolean })` which maps to HTML boolean attributes
- Reflecting properties use `reflect: true` in options
- Custom attributes via `attribute: 'kebab-case-name'`

### Context Consumption
Components consume context from `DiscordMessages`:
```ts
@consume({ context: messagesLightTheme })
@property({ type: Boolean, reflect: true, attribute: 'light-theme' })
public accessor lightTheme = false;
```

### Global Configuration
Configure avatars and profiles via `globalThis.$discordMessage` or `setConfig()`:
```ts
import { setConfig } from '@skyra/discord-components-core';
setConfig({
  profiles: { skyra: { author: 'Skyra', avatar: '...', roleColor: '#1e88e5' } },
  avatars: { default: 'blue', myAvatar: 'https://...' }
});
```

## Contribution Guidelines

- Follow conventional commits (enforced by commitlint)
- Write JSDoc comments for all public APIs
- ESLint must pass before PRs (GitHub Actions runs `yarn lint --fix=false`)
- Run `yarn inject` after adding/removing components to regenerate exports