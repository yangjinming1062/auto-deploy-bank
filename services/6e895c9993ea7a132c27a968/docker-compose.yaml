services:
  android-builder:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: raphael-android-builder
    environment:
      - ANDROID_HOME=/opt/android-sdk
      - ANDROID_SDK_ROOT=/opt/android-sdk
      - ANDROID_NDK_ROOT=/opt/android-sdk/ndk/21.4.7075529
      - org.gradle.jvmargs=-Xmx2048M
    volumes:
      # Mount the built JAR/AAR file for security scanning
      - ./target.jar:/app/target.jar
      # Mount output directory for additional artifacts
      - ./output:/app/output
      # Mount gradle cache for faster builds
      - gradle-cache:/root/.gradle
    ports:
      - "43794:43794"
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 1G

volumes:
  gradle-cache: