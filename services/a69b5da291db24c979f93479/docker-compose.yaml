version: "3.8"

services:
    web:
        build: .
        ports:
            - "40908:5000"
        environment:
            - NODE_ENV=production
            - PORT=5000
            - REDIS_URL=redis://redis:6379
            - LOG_LEVEL=debug
        depends_on:
            redis:
                condition: service_healthy
        healthcheck:
            test: ["CMD", "wget", "--spider", "-q", "http://localhost:5000/"]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 10s
        deploy:
            resources:
                limits:
                    cpus: '2.0'
                    memory: 4G
                reservations:
                    cpus: '1.0'
                    memory: 1G

    redis:
        image: redis:7-alpine
        expose:
            - "6379"
        healthcheck:
            test: ["CMD", "redis-cli", "ping"]
            interval: 10s
            timeout: 5s
            retries: 5