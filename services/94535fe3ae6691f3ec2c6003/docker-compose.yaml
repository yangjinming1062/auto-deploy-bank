services:
  azure-functions-app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "40672:7071"
    environment:
      - AZURE_SEARCH_SERVICE_ENDPOINT=${AZURE_SEARCH_SERVICE_ENDPOINT:-https://your-search-service.search.windows.net}
      - AZURE_SEARCH_INDEX=${AZURE_SEARCH_INDEX:-my-demo-index}
      - AZURE_SEARCH_ADMIN_KEY=${AZURE_SEARCH_ADMIN_KEY:-}
      - AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT:-https://your-openai-endpoint.openai.azure.com}
      - AZURE_OPENAI_KEY=${AZURE_OPENAI_KEY:-}
      - AZURE_OPENAI_EMBEDDING_DEPLOYMENT=${AZURE_OPENAI_EMBEDDING_DEPLOYMENT:-text-embedding-3-large}
      - SENTENCE_TRANSFORMERS_TEXT_EMBEDDING_MODEL=${SENTENCE_TRANSFORMERS_TEXT_EMBEDDING_MODEL:-all-MiniLM-L6-v2}
      - AzureWebJobsStorage=${AzureWebJobsStorage:-UseDevelopmentStorage=true}
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 1G
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7071/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s