services:
  web-tools:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ledger-web-tools
    ports:
      - "40646:3000"
    entrypoint: [""]
    command: ["/usr/local/bin/node", "/app/apps/web-tools/.next/standalone/apps/web-tools/server.js"]
    environment:
      - NODE_ENV=production
      - PORT=3000
      - MOCK=false
      - MOCK_COUNTERVALUES=false
      - EXPERIMENTAL_BLE=false
      - EXPERIMENTAL_CURRENCIES=
      - EXPERIMENTAL_EXPLORERS=
      - EXPERIMENTAL_LANGUAGES=
      - EXPERIMENTAL_MANAGER=false
      - EXPERIMENTAL_SWAP=false
      - PLATFORM_API_URL=https://api.ledger.com
      - PLATFORM_API_VERSION=1
      - PLATFORM_MANIFEST_API_URL=https://live-app-store.ledger.com
      - TRUSTCHAIN_API_PROD=https://trustchain.api.live.ledger.com
      - TRUSTCHAIN_API_STAGING=https://trustchain.staging.live.ledger.com
      - CLOUD_SYNC_API_PROD=https://cloudsync.api.live.ledger.com
      - CLOUD_SYNC_API_STAGING=https://cloudsync.staging.live.ledger.com
      - LEDGER_COUNTERVALUES_API=https://countervalues.live.ledger.com
      - LEDGER_REST_API_BASE=https://explorers.api.live.ledger.com
      - MANAGER_API_BASE=https://manager.api.live.ledger.com
      - SWAP_API_BASE=https://swap.ledger.com
      - BUY_API_BASE=https://buy.ledger.com
      - MARKET_API_URL=https://live.ledger.com/api/market
      - CAL_REF=
      - CAL_SERVICE_URL=https://service-cal.ledger.com
      - CAL_SERVICE_URL_STAGING=https://service-cal.staging.live.ledger.com
      - DYNAMIC_CAL_BASE_URL=https://cdn.live.ledger.com
      - FEATURE_FLAGS={}
      - VERBOSE=
      - DEVICE_PROXY_URL=
      - DEVICE_PROXY_MODEL=
      - SPECULOS_API_PORT=4040
      - SPECULOS_DEVICE=nanox
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 1G
    restart: unless-stopped
    networks:
      - ledger-network

networks:
  ledger-network:
    driver: bridge
