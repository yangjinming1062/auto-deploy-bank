services:
  manga-translator:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: manga_translator
    ports:
      - "41233:8000"
    environment:
      - PYTHONUNBUFFERED=1
      # Translation API keys (leave empty to disable specific translator)
      - MT_WEB_NONCE=
      - BAIDU_APP_ID=
      - BAIDU_SECRET_KEY=
      - YOUDAO_APP_KEY=
      - YOUDAO_SECRET_KEY=
      - DEEPL_AUTH_KEY=
      - OPENAI_API_KEY=
      - OPENAI_MODEL=chatgpt-4o-latest
      - OPENAI_API_BASE=https://api.openai.com/v1
      - OPENAI_HTTP_PROXY=
      - OPENAI_GLOSSARY_PATH=./dict/mit_glossary.txt
      - GROQ_API_KEY=
      - GROQ_MODEL=mixtral-8x7b-32768
      - SAKURA_API_BASE=http://127.0.0.1:8080/v1
      - SAKURA_VERSION=0.9
      - SAKURA_DICT_PATH=./sakura_dict.txt
      - CAIYUN_TOKEN=
      - GEMINI_API_KEY=
      - GEMINI_MODEL=gemini-1.5-flash-002
      - DEEPSEEK_API_KEY=
      - DEEPSEEK_API_BASE=https://api.deepseek.com
      - DEEPSEEK_MODEL=deepseek-chat
      - TOGETHER_API_KEY=
      - TOGETHER_VL_MODEL=Qwen/Qwen2.5-VL-72B-Instruct
      - CUSTOM_OPENAI_API_KEY=ollama
      - CUSTOM_OPENAI_API_BASE=http://localhost:11434/v1
      - CUSTOM_OPENAI_MODEL=
      - CUSTOM_OPENAI_MODEL_CONF=
    volumes:
      - ./result:/app/result
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 1G
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/"]
      interval: 30s
      timeout: 10s
      start_period: 120s
      retries: 3
    restart: unless-stopped