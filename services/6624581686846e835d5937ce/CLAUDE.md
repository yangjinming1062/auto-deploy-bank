# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is the documentation repository for AWS Amplify (docs.amplify.aws). It is a Next.js application that uses MDX for content and generates static pages for multiple platforms (Javascript, React, Flutter, Swift, Android, etc.).

## Commands

```bash
# Install dependencies (requires Yarn Berry)
yarn

# Start development server
yarn dev

# Run unit tests
yarn test:unit

# Run e2e tests
yarn test:e2e

# Lint code
yarn lint

# Check spelling in mdx files
yarn spellcheck

# Build for production (static export)
yarn build
```

## Architecture

- **Routing**: The site uses standard [Next.js Pages Router](https://nextjs.org/docs/pages). Route structure is `src/pages/[platform]/...`.
- **Content**: Documentation pages are written in **MDX** (`src/pages/**/*.mdx`).
- **Fragments**: Platform-specific content is handled via reusable fragments in `src/fragments/`.
- **Inline Filters**: Multi-platform content on a single page uses `<InlineFilter>` components.
- **Directory**: The sidebar navigation is generated from `src/directory/directory.mjs`. Changes to this file are generated by `yarn prebuild` before any build/dev process.
- **Static Generation**: Pages use `getStaticPaths` and `getStaticProps`. Most pages export a `meta` object (title, description, platforms) and use `getCustomStaticPath`.

## Key Conventions

- **Platform Routing**: A page at `src/pages/[platform]/auth/xyz.mdx` renders at `/<platform>/auth/xyz`.
- **Fragments**: When content must differ significantly between platforms, it is extracted to `src/fragments/lib/<feature>/<platform>.mdx` and imported into the parent page.
- **Global Nav**: Updates to the sidebar require editing `src/directory/directory.mjs` and the associated `.mjs` files in subdirectories.

## Testing

- **Unit**: Jest with React Testing Library. Run with `yarn test:unit`.
- **E2E**: Puppeteer-based. Run with `yarn test:e2e`.