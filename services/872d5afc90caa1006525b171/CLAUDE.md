# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Spring Boot is a Java-based framework that makes it easy to create stand-alone, production-grade Spring applications. This is the main source repository containing the framework core, starters, build plugins, CLI, and test infrastructure.

## Build Commands

Gradle wrapper is generated by the `gradle/actions/setup-gradle` GitHub action. To use locally, run:

```bash
# Generate gradle wrapper (requires Gradle installed, or copy from CI cache)
gradle wrapper --gradle-version 9.3.0

# Full build with tests
./gradlew build

# Build without running tests
./gradlew assemble

# Run only tests
./gradlew test

# Run a specific test class
./gradlew test --tests "org.springframework.boot.sample.TestClass"

# Format code (Spring Java Format)
./gradlew format

# Check code formatting
./gradlew formatCheck

# Run checkstyle
./gradlew checkstyleMain

# Compile without testing
./gradlew compileJava compileTestJava

# Build specific module
./gradlew :core:spring-boot:build

# Publish to local repository
./gradlew publishToMavenLocal
```

**Gradle Version**: 9.3.0 (configured in `gradle/wrapper/gradle-wrapper.properties`)

## Java Requirements

- **Build Java Version**: Java 25 (configured in `JavaConventions.BUILD_JAVA_VERSION`)
- **Runtime Java Version**: Java 17+ (configured in `JavaConventions.RUNTIME_JAVA_VERSION`)
- The project uses Gradle toolchains for managing Java versions

## Project Structure

### Core Modules (`core/`)
- `spring-boot` - Main Spring Boot library with `SpringApplication` class
- `spring-boot-autoconfigure` - Auto-configuration engine and annotations
- `spring-boot-autoconfigure-processor` - Annotation processor for configuration properties
- `spring-boot-test` / `spring-boot-test-autoconfigure` - Testing support
- `spring-boot-docker-compose` - Docker Compose support
- `spring-boot-properties-migrator` - Migration tool for configuration properties

### Feature Modules (`module/`)
Feature-specific modules like `spring-boot-actuator`, `spring-boot-amqp`, `spring-boot-data-jpa`, etc. Each typically provides auto-configuration and dependency management for a specific technology.

### Starters (`starter/`)
Convenient dependency descriptors in `spring-boot-starter-*` directories. These are meta-dependencies that bring in all required dependencies for a technology.

### Build Plugins (`build-plugin/`)
- `spring-boot-gradle-plugin` - Official Gradle plugin
- `spring-boot-maven-plugin` - Official Maven plugin (in separate repository)
- `spring-boot-antlib` - Ant-based build support

### Test Infrastructure
- `integration-test/` - Integration test modules
- `smoke-test/` - End-to-end smoke tests for various starters
- `test-support/` - Shared test utilities (`spring-boot-test-support`, `spring-boot-docker-test-support`)

### Configuration Files
- `config/checkstyle/` - Checkstyle configuration
- `buildSrc/` - Build logic and custom Gradle plugins
- `gradle/plugins/` - Additional Gradle plugins (cycle detection, etc.)

## Architecture Patterns

### Auto-configuration
Auto-configuration is discovered via `META-INF/spring.factories` files. When a starter is on the classpath, its auto-configuration classes are loaded automatically. Key files:
- `src/main/resources/META-INF/spring.factories` - Lists auto-configuration classes
- `src/main/resources/META-INF/spring/aot.factories` - AOT-processed factories

### Convention Plugins (`buildSrc/`)
The build uses convention plugins in `org.springframework.boot.build` package:
- `ConventionsPlugin` - Applies Java, Maven, Kotlin, and other conventions
- `JavaConventions` - Configures compilation, testing, and dependency management
- `ArchitecturePlugin` - Enforces architectural constraints

### Configuration Properties
Use `@ConfigurationProperties` annotations with an associated `*Properties` class. The processor in `spring-boot-autoconfigure-processor` generates metadata.

## Code Style

- Uses **Spring Java Format** plugin for consistent formatting
- **Checkstyle** enforces code quality rules (configured in `config/checkstyle/`)
- Compiler flags: `-parameters`, `-Werror`, `-Xlint:unchecked`, `-Xlint:deprecation`, `-Xlint:rawtypes`, `-Xlint:varargs`
- License headers required on all files (Apache License 2.0)

## Testing

- **JUnit 5** (Jupiter) with JUnit Platform
- Test retries: Up to 3 retries on CI (`CI=true` environment variable)
- Max heap for tests: 1536M
- Test slices: Use `@SpringBootTest` with `webEnvironment` options or test-specific slices like `@DataJpaTest`

## Working with Pull Requests

- Submit only genuine pull requests (not for dependency-only upgrades)
- Dependency upgrades are handled semi-automatically
- Describe changes clearly, reference issues with `#` prefix
- All commits require DCO sign-off (see `.github/dco.yml`)